# Secrets defined here are available for reference under registry/password, env/secret, builder/secrets,
# and accessories/*/env/secret in config/deploy.yml. All secrets should be pulled from either
# password manager, ENV, or a file. DO NOT ENTER RAW CREDENTIALS HERE! This file needs to be safe for git.
#
# Note: Kamal's secrets parser does NOT support ${VAR:-fallback} bash syntax.
# Use simple KEY=value or KEY=$(command) format only.

# Registry password from ENV (if set) or gh CLI fallback
KAMAL_REGISTRY_PASSWORD=$(printenv KAMAL_REGISTRY_PASSWORD || gh config get -h github.com oauth_token)

# Production server IP from ENV
DEPLOY_SERVER=$(printenv DEPLOY_SERVER)

# Rails master key (prefer ENV, fallback to local file)
RAILS_MASTER_KEY=$(printenv RAILS_MASTER_KEY || cat config/master.key)

# Admin credentials for db:seed from ENV (required)
ADMIN_EMAIL=$(
  if [ -z "${ADMIN_EMAIL:-}" ]; then
    echo "ERROR: ADMIN_EMAIL environment variable must be set for db:seed" >&2
    exit 1
  fi
  printf '%s\n' "$ADMIN_EMAIL"
)
ADMIN_PASSWORD=$(
  if [ -z "${ADMIN_PASSWORD:-}" ]; then
    echo "ERROR: ADMIN_PASSWORD environment variable must be set for db:seed" >&2
    exit 1
  fi
  printf '%s\n' "$ADMIN_PASSWORD"
)
